trigger:
  branches:
    include:
      - main

jobs:
  - job: test_auth
    displayName: 'Test Authentication to Salesforce Org'
    pool:
      name: 'mess'  # Use your self-hosted agent pool

    steps:
      # Step 1: Checkout the repository
      - checkout: self
        displayName: 'Checkout repository'

      # Step 2: Verify Salesforce CLI Path (Ensure CLI is installed)
      - script: |
          echo "Verifying Salesforce CLI installation..."
          sfdx --version
        displayName: 'Verify Salesforce CLI'

      # Step 3: Authenticate to DevOrg using the secret
      - script: |
          echo "Authenticating to DevOrg..."
          echo $(DEVORG_SFDX_AUTH_URL) > auth-url.txt
          sfdx auth:sfdxurl:store --sfdx-url-file auth-url.txt
        displayName: 'Authenticate to DevOrg'

      # Step 4: Verify Authentication
      - script: |
          echo "Verifying authentication..."
          sfdx force:org:display --targetusername DevOrg
        displayName: 'Verify Authentication'
