trigger:
- main  # Defines that the pipeline runs when there is a push to the 'main' branch.

pool:
  vmImage: 'ubuntu-latest'  # Specifies the environment in which the pipeline will run.

steps:
- task: Checkout@1   # You can change this to Checkout@2 if needed
  displayName: 'Checkout repository'

- script: npm install -g sfdx-cli
  displayName: 'Install Salesforce CLI'

- script: |
    sfdx auth:web:login --setalias DevOrg --instanceurl https://login.salesforce.com --setdefaultusername
  displayName: 'Authenticate to DevOrg'
  env:
    SFDX_AUTH_URL: $(DEVORG_SFDX_AUTH_URL)

- script: |
    sfdx force:source:deploy -p force-app --targetusername DevOrg --checkonly --testlevel RunLocalTests
  displayName: 'Deploy to DevOrg'

- script: |
    sfdx auth:web:login --setalias UatOrg --instanceurl https://login.salesforce.com --setdefaultusername
  displayName: 'Authenticate to UatOrg'
  env:
    SFDX_AUTH_URL: $(UATORG_SFDX_AUTH_URL)

- script: |
    sfdx force:source:deploy -p force-app --targetusername UatOrg --checkonly --testlevel RunLocalTests
  displayName: 'Deploy to UatOrg'
